# Copyright 2025 Deutsche Telekom IT GmbH
#
# SPDX-License-Identifier: Apache-2.0

# This is only needed when using the cert-manager to issue certificates.
- op: add
  path: /spec/template/spec/volumes/-
  value:
    name: cert-volume
    secret:
      secretName: file-manager-cert
- op: add
  path: /spec/template/spec/containers/0/volumeMounts/-
  value:
    name: cert-volume
    mountPath: /etc/tls
    readOnly: true
# This patch will configure the necessary service account token projection for the file manager client
- op: add
  path: /spec/template/spec/volumes/-
  value:
    name: file-manager-token
    projected:
      sources:
        - serviceAccountToken:
            path: file-manager-token
            expirationSeconds: 600
            audience: sts.amazonaws.com
- op: add
  path: /spec/template/spec/containers/0/volumeMounts/-
  value:
    name: file-manager-token
    mountPath: /var/run/secrets/file-manager
    readOnly: true
